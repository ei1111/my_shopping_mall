<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<body>
<div class="container">
  <div th:replace="fragments/bodyHeader :: bodyHeader"/>

  <!-- Begin page content -->
  <main class="flex-shrink-0">
    <div class="container">
      <h1 class="mt-5">ê²Œì‹œíŒ</h1>

      <div>ì´ ê±´ìˆ˜: <span id="totalCount"></span></div>
      <form id="searchForm" class="row g-3 d-flex justify-content-end">
        <div class="col-auto">
          <label for="searchText" class="visually-hidden"></label>
          <input type="text" class="form-control" id="searchText" name="searchText">
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-light mb-3">ê²€ìƒ‰</button>
        </div>
      </form>

      <table class="table table-striped">
        <thead>
        <tr>
          <th scope="col">ë²ˆí˜¸</th>
          <th scope="col">ì œëª©</th>
          <th scope="col">ì‘ì„±ì</th>
        </tr>
        </thead>
        <tbody id="boardTableBody">
        </tbody>
      </table>


      <nav aria-label="Page navigation example">
        <ul class="pagination justify-content-center" id="pagination">
          &lt;!&ndash; JSë¡œ í˜ì´ì§€ ë²ˆí˜¸ ë²„íŠ¼ì´ ì—¬ê¸°ì— ë“¤ì–´ê° &ndash;&gt;
        </ul>
      </nav>

      <div class="text-end">
        <a th:href="@{/board/form}" type="button" class="btn btn-primary">ì“°ê¸°</a>
      </div>
    </div>
  </main>
  <br/>
  <div th:replace="fragments/footer :: footer" />
</div> <!-- /container -->

<script th:inline="javascript">
  document.addEventListener("DOMContentLoaded", function () {
    loadBoardList(); // ì´ˆê¸° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°

    // ğŸ” ê²€ìƒ‰ ì´ë²¤íŠ¸
    document.getElementById("searchForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const keyword = document.getElementById("searchText").value;
      loadBoardList(0, keyword); // ê²€ìƒ‰ ì‹œ 0í˜ì´ì§€ë¶€í„°
    });
  });

  // ğŸ“¦ ê²Œì‹œê¸€ ë¡œë”© + í˜ì´ì§• ì²˜ë¦¬
  function loadBoardList(page = 0, searchText = '') {
    const url = new URL('/board/v1/list', window.location.origin);
    url.searchParams.append('page', page);
    if (searchText) {
      url.searchParams.append('searchText', searchText);
    }

    fetch(url)
    .then(response => response.json())
    .then(data => {
      renderTotalCount(data.totalCount);
      renderBoardTable(data.boards);
      renderPagination(
          data.pageNumber, data.totalPages,
          data.startPage, data.endPage,
          searchText
      );
    })
    .catch(error => {
      console.error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
    });
  }

  // ğŸ“Š ì´ ê±´ìˆ˜ í‘œì‹œ
  function renderTotalCount(count) {
    document.getElementById('totalCount').innerText = count;
  }

  // ğŸ“„ ê²Œì‹œê¸€ í…Œì´ë¸” ë Œë”ë§
  function renderBoardTable(boards) {
    const tbody = document.getElementById('boardTableBody');
    tbody.innerHTML = '';

    boards.forEach(board => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${board.rowNum}</td>
        <td><a href="/boards/new?boardId=${board.boardId}">${board.title}</a></td>
        <td>${board.writer || 'í™ê¸¸ë™'}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // â© í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
  function renderPagination(currentPage, totalPages, startPage, endPage, searchText = '') {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    // Previous
    const prevDisabled = currentPage === 0 ? 'disabled' : '';
    pagination.innerHTML += `
      <li class="page-item ${prevDisabled}">
        <a class="page-link" href="#" onclick="loadBoardList(${currentPage - 1}, '${searchText}')">Previous</a>
      </li>
    `;

    // Page numbers
    for (let i = startPage; i <= endPage; i++) {
      const active = (i - 1) === currentPage ? 'active' : '';
      pagination.innerHTML += `
        <li class="page-item ${active}">
          <a class="page-link" href="#" onclick="loadBoardList(${i - 1}, '${searchText}')">${i}</a>
        </li>
      `;
    }

    // Next
    const nextDisabled = currentPage + 1 >= totalPages ? 'disabled' : '';
    pagination.innerHTML += `
      <li class="page-item ${nextDisabled}">
        <a class="page-link" href="#" onclick="loadBoardList(${currentPage + 1}, '${searchText}')">Next</a>
      </li>
    `;
  }
</script>
</body>
</html>